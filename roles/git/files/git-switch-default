#!/bin/bash
# git-switch-default - リモートのデフォルトブランチに切り替えるコマンド

# デフォルトブランチ名を取得（リモートアクセスなしでローカルキャッシュから取得）
default_branch=$(git symbolic-ref refs/remotes/origin/HEAD 2>/dev/null | sed 's@^refs/remotes/origin/@@')

# シンボリックリファレンスが見つからなかった場合のフォールバック
if [ -z "$default_branch" ]; then
  echo "ローカルにデフォルトブランチ情報がありません。リモートから取得します..."
  git remote set-head origin --auto >/dev/null 2>&1
  default_branch=$(git symbolic-ref refs/remotes/origin/HEAD 2>/dev/null | sed 's@^refs/remotes/origin/@@')
  
  # それでも取得できない場合は終了
  if [ -z "$default_branch" ]; then
    echo "デフォルトブランチを特定できませんでした。"
    exit 1
  fi
fi

git switch "$default_branch"
